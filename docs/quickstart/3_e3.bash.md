# e3.bash

Included with the main e3 repository are a pair of scripts, `e3_building_config.bash` and `e3.bash`. They can be used
to automate setting up a local  e3 environment. In particular, they can do all of the following.

* Set which version of EPICS base/require you would like to install
* Decide on the install location
* Build and install EPICS base with the patches needed to use e3
* Build and install require
* Build and install groups of modules

An example of the above is the following.

```bash
$ bash e3_building_config.bash -b 7.0.4 -r 3.3.0 -t /opt/epics setup
$ bash e3.bash base
$ bash e3.bash req
$ bash e3.bash -c mod
```

## Configuring EPICS base/require versions

Configuration for your local install is done with `e3_building_config.bash`. The usage for this is as follows.

```bash
$ bash e3_building_config.bash -h

Usage    : e3_building_config.bash options setup 

              possbile options

              [-t <target_path>]     [-b <base_version>]      [-r <require_version>] [-c <base_tag>] 
              [-n <ifc14xx_cc_path>] [-m <ifc14xx_cc_version] [-l <poky_cc_path]     [-k <poky_cc_version>] 

               -t : default /epics
               -b : default 7.0.4
               -r : default 3.3.0
               -c : default 7.0.4
               -n : default /opt/ifc14xx
               -m : default 2.6-4.14
               -l : default /opt/cct
               -k : default 2.6-4.14

 bash e3_building_config.bash -t ${HOME} -r 3.3.0 setup
```

The main options to use are the ones listed in the example: `-b` to selecte the version of EPICS base, `-r` to
select the version of `require`, and `-t` to select the desired install location.

The result of this script is the generation of a number of different `.local` files, such as `CONFIG_BASE.local`,
`REQUIRE_CONFIG_MODULE.local`, `RELEASE.local`, and `RELEASE_DEV.local`. These are used to override the configuration
options in the different repositories.

## Building EPICS base

The basic philosophy of e3 is to use wrappers which contain metadata (and possibly some patches) to allow for
consistent custom building of community EPICS modules with minimal changes required. EPICS base is built in 
the same way, using the wrapper [e3-base](https://gitlab.esss.lu.se/e3/e3-base). The main purpose of this wrapper
is to configure EPICS base and to apply certain site-specific patches that are necessary for the e3 EPICS environment.

In order to use `e3.bash` to build EPICS base, you should run
```bash
$ bash e3.bash base
```
This will clone EPICS base, apply the necessary patches, and build it with the configuration supplied above.

Note that EPICS base takes a while to build! Go get yourself a coffee.

## Building require

Require is an integral part of e3. As stated elsewhere, in a certain sense require *is* e3. So of course we need to
install that next, which is done via
```bash
$ bash e3.bash req
```
This is must simpler and quicker than EPICS base. If you have been following the steps above, then this will be
installed together with EPICS base in the path `${EPICS_BASE}/require/${E3_REQUIRE_VERSION}`.


## Building modules